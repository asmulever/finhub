{
  "version": 3,
  "sources": ["../../Frontend/auth/authStore.js", "../../Frontend/apicliente.js", "../../Frontend/paginas/register.js"],
  "sourcesContent": ["const TOKEN_KEY = 'finhub_token';\nconst TOKEN_EXP_KEY = 'finhub_token_exp';\nconst PROFILE_KEY = 'finhub_profile';\nconst storage = sessionStorage;\n\nconst nowSeconds = () => Math.floor(Date.now() / 1000);\n\nexport const authStore = {\n  getToken() {\n    const exp = Number(storage.getItem(TOKEN_EXP_KEY) || 0);\n    if (exp && nowSeconds() >= exp) {\n      this.clearToken();\n      return null;\n    }\n    return storage.getItem(TOKEN_KEY);\n  },\n  setToken(token, expiresInSeconds = 3600) {\n    storage.setItem(TOKEN_KEY, token);\n    storage.setItem(TOKEN_EXP_KEY, String(nowSeconds() + expiresInSeconds));\n  },\n  clearToken() {\n    storage.removeItem(TOKEN_KEY);\n    storage.removeItem(TOKEN_EXP_KEY);\n    storage.removeItem(PROFILE_KEY);\n  },\n  setProfile(profile) {\n    storage.setItem(PROFILE_KEY, JSON.stringify(profile));\n  },\n  getProfile() {\n    const value = storage.getItem(PROFILE_KEY);\n    return value ? JSON.parse(value) : null;\n  },\n};\n", "import { authStore } from './auth/authStore.js';\n\n/** Devuelve en tiempo de ejecuci\u00F3n la URL base que indica el entorno sin ning\u00FAn hardcode. */\nexport const getBaseUrl = (() => {\n  let cached = '';\n  return () => {\n    if (cached !== '') {\n      return cached;\n    }\n    const envBase = window.__ENV?.API_BASE_URL;\n    if (!envBase) {\n      throw new Error('API_BASE_URL no est\u00E1 configurada en window.__ENV');\n    }\n    cached = envBase.endsWith('/') ? envBase.slice(0, -1) : envBase;\n    return cached;\n  };\n})();\n\n/** Construye la URL final agregando la base configurada si la ruta es relativa. */\nconst buildUrl = (path) => (path.startsWith('http') ? path : `${getBaseUrl()}${path}`);\n\n/** Borra el token y redirige al login (forzando la ventana top) si el backend responde con 401. */\nconst handleUnauthorized = () => {\n  authStore.clearToken();\n  const target = '/';\n  if (window.top && window.top !== window) {\n    window.top.location.href = target;\n  } else {\n    window.location.href = target;\n  }\n};\n\n/** Fusiona headers adicionales con el header JSON obligatorio. */\nconst buildHeaders = (extraHeaders) => ({\n  'Content-Type': 'application/json',\n  ...extraHeaders,\n});\n\n/** Extrae el payload JSON o devuelve null si no viene contenido v\u00E1lido. */\nconst parsePayload = async (response) => response.json().catch(() => null);\n\n/**\n * Env\u00EDa una petici\u00F3n HTTP contra la API, gestionando tokens, errores y JSON.\n * @param path Ruta relativa o absoluta del recurso.\n * @param options Configuraci\u00F3n adicional de fetch.\n */\nexport const apiClient = async (path, options = {}) => {\n  const { method = 'GET', body, headers = {}, ...rest } = options;\n  const composedHeaders = buildHeaders(headers);\n  const token = authStore.getToken() ?? localStorage.getItem(\"jwt\");\n\n  if (token) {\n    composedHeaders.Authorization = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(buildUrl(path), {\n    method,\n    credentials: 'include',\n    headers: composedHeaders,\n    body: body === undefined ? undefined : JSON.stringify(body),\n    ...rest,\n  });\n\n  const payload = await parsePayload(response);\n  if (!response.ok) {\n    if (response.status === 401) {\n      handleUnauthorized();\n    }\n    const err = payload?.error ?? {\n      code: `http.${response.status}`,\n      message: response.statusText,\n    };\n    throw { status: response.status, error: err };\n  }\n\n  return payload;\n};\n\n/** Genera un helper para m\u00E9todos que env\u00EDan body JSON. */\nconst withBody = (method) => (path, body) => apiClient(path, { method, body });\n\n/** Genera un helper para m\u00E9todos sin body. */\nconst withoutBody = (method) => (path) => apiClient(path, { method });\n\n/** Env\u00EDa un POST con body serializado. */\nexport const postJson = withBody('POST');\n\n/** Env\u00EDa un PATCH con body serializado. */\nexport const patchJson = withBody('PATCH');\n\n/** Ejecuta una petici\u00F3n DELETE sin body. */\nexport const deleteJson = withoutBody('DELETE');\n\n/** Ejecuta una petici\u00F3n GET sin body. */\nexport const getJson = withoutBody('GET');\n", "import { postJson } from '../apicliente.js';\n\nconst emailPattern = '^[^\\\\s@]+@[^\\\\s@]+\\\\.[^\\\\s@]+$';\n\nconst render = () => {\n  const app = document.getElementById('app');\n  if (!app) return;\n  app.innerHTML = `\n    <div class=\"container\">\n      <div class=\"row justify-content-between\" style=\"gap:16px; justify-content:center;\">\n        <div class=\"col-12 col-sm-10 col-lg-6\">\n          <section class=\"auth-card\">\n            <div class=\"card-body\">\n              <div class=\"brand-row\">\n                <img src=\"/logo/full_logoweb.png\" alt=\"FinHub\" class=\"logo\" />\n                <h2 class=\"title\">Crear cuenta FinHub</h2>\n              </div>\n              <p class=\"subtitle\">Tu cuenta se crea inactiva hasta que el proceso de activacion por mail ,sea completado</p>\n              <form id=\"register-form\">\n                <div class=\"form-group\">\n                  <label for=\"email\">Correo</label>\n                  <input id=\"email\" name=\"email\" type=\"email\" required autocomplete=\"username\" pattern=\"${emailPattern}\" />\n                </div>\n                <div class=\"form-group password-group\">\n                  <label for=\"password\">Contrase\u00F1a</label>\n                  <div class=\"password-field\">\n                    <input id=\"password\" name=\"password\" type=\"password\" required autocomplete=\"new-password\" />\n                  </div>\n                </div>\n                <div class=\"form-group password-group\">\n                  <label for=\"password-confirm\">Confirmar contrase\u00F1a</label>\n                  <div class=\"password-field\">\n                    <input id=\"password-confirm\" name=\"password-confirm\" type=\"password\" required autocomplete=\"new-password\" />\n                  </div>\n                  <p id=\"match-hint\" class=\"hint\" aria-live=\"polite\"></p>\n                </div>\n                <button type=\"submit\">Registrarme</button>\n                <p id=\"error-message\" class=\"error\" aria-live=\"polite\"></p>\n                <p class=\"footnote\">\u00BFYa tienes cuenta? <a href=\"/\">Inicia sesi\u00F3n</a></p>\n              </form>\n              <p class=\"status-line\">Estado inicial: <span class=\"status-strong\">inactive</span></p>\n            </div>\n          </section>\n        </div>\n      </div>\n    </div>\n    <div class=\"loading-overlay\" id=\"register-loading\">\n      <div class=\"loading-spinner\" role=\"status\" aria-label=\"Enviando registro\"></div>\n    </div>\n  `;\n\n  const form = document.getElementById('register-form');\n  const errorMessage = document.getElementById('error-message');\n   const matchHint = document.getElementById('match-hint');\n  const loadingOverlay = document.getElementById('register-loading');\n  form?.addEventListener('submit', async (event) => {\n    event.preventDefault();\n    const emailInput = document.getElementById('email');\n    const passwordInput = document.getElementById('password');\n    const confirmInput = document.getElementById('password-confirm');\n    const email = emailInput?.value.trim() ?? '';\n    const password = passwordInput?.value ?? '';\n    const confirm = confirmInput?.value ?? '';\n    const submitButton = form.querySelector('button[type=\"submit\"]');\n    const showLoading = (show) => {\n      if (!loadingOverlay) return;\n      if (show) {\n        loadingOverlay.classList.add('active');\n      } else {\n        loadingOverlay.classList.remove('active');\n      }\n      if (submitButton) {\n        submitButton.disabled = show;\n      }\n    };\n    const updateMatchHint = () => {\n      if (!matchHint) return;\n      matchHint.className = 'hint';\n      if (confirmInput?.value === '') {\n        matchHint.textContent = '';\n        return;\n      }\n      if (passwordInput?.value === confirmInput?.value) {\n        matchHint.textContent = 'Coinciden';\n        matchHint.classList.add('success');\n      } else {\n        matchHint.textContent = 'No coinciden';\n        matchHint.classList.add('error');\n      }\n    };\n    updateMatchHint();\n    if (!email.match(emailPattern)) {\n      errorMessage.textContent = 'Email inv\u00E1lido';\n      return;\n    }\n    if (password.length < 6) {\n      errorMessage.textContent = 'La contrase\u00F1a debe tener al menos 6 caracteres';\n      return;\n    }\n    if (password !== confirm) {\n      errorMessage.textContent = 'Las contrase\u00F1as no coinciden';\n      return;\n    }\n    try {\n      errorMessage.textContent = '';\n      showLoading(true);\n      await postJson('/auth/register', { email, password });\n      window.location.href = '/';\n    } catch (err) {\n      const message = err?.error?.message ?? 'No se pudo registrar';\n      errorMessage.textContent = message;\n    } finally {\n      showLoading(false);\n    }\n  });\n\n  const passwordInput = document.getElementById('password');\n  const confirmInput = document.getElementById('password-confirm');\n  const updateHintLive = () => {\n    if (!matchHint) return;\n    matchHint.className = 'hint';\n    if (confirmInput?.value === '') {\n      matchHint.textContent = '';\n      return;\n    }\n    if (passwordInput?.value === confirmInput?.value) {\n      matchHint.textContent = 'Coinciden';\n      matchHint.classList.add('success');\n    } else {\n      matchHint.textContent = 'No coinciden';\n      matchHint.classList.add('error');\n    }\n  };\n  passwordInput?.addEventListener('input', updateHintLive);\n  confirmInput?.addEventListener('input', updateHintLive);\n\n  // Focus y navegaci\u00F3n secuencial\n  const sequence = [document.getElementById('email'), passwordInput, confirmInput, form?.querySelector('button[type=\"submit\"]')];\n  const ensureFocus = (target) => {\n    if (target && typeof target.focus === 'function') {\n      target.focus();\n    }\n  };\n  ensureFocus(sequence[0]);\n\n  sequence.forEach((el, idx) => {\n    if (!el) return;\n    el.addEventListener('keydown', (event) => {\n      if (event.key !== 'Tab') return;\n      event.preventDefault();\n      const next = sequence[(idx + 1) % sequence.length];\n      ensureFocus(next);\n    });\n  });\n};\n\ndocument.addEventListener('DOMContentLoaded', render);\n"],
  "mappings": ";AAAA,IAAM,YAAY;AAClB,IAAM,gBAAgB;AACtB,IAAM,cAAc;AACpB,IAAM,UAAU;AAEhB,IAAM,aAAa,MAAM,KAAK,MAAM,KAAK,IAAI,IAAI,GAAI;AAE9C,IAAM,YAAY;AAAA,EACvB,WAAW;AACT,UAAM,MAAM,OAAO,QAAQ,QAAQ,aAAa,KAAK,CAAC;AACtD,QAAI,OAAO,WAAW,KAAK,KAAK;AAC9B,WAAK,WAAW;AAChB,aAAO;AAAA,IACT;AACA,WAAO,QAAQ,QAAQ,SAAS;AAAA,EAClC;AAAA,EACA,SAAS,OAAO,mBAAmB,MAAM;AACvC,YAAQ,QAAQ,WAAW,KAAK;AAChC,YAAQ,QAAQ,eAAe,OAAO,WAAW,IAAI,gBAAgB,CAAC;AAAA,EACxE;AAAA,EACA,aAAa;AACX,YAAQ,WAAW,SAAS;AAC5B,YAAQ,WAAW,aAAa;AAChC,YAAQ,WAAW,WAAW;AAAA,EAChC;AAAA,EACA,WAAW,SAAS;AAClB,YAAQ,QAAQ,aAAa,KAAK,UAAU,OAAO,CAAC;AAAA,EACtD;AAAA,EACA,aAAa;AACX,UAAM,QAAQ,QAAQ,QAAQ,WAAW;AACzC,WAAO,QAAQ,KAAK,MAAM,KAAK,IAAI;AAAA,EACrC;AACF;;;AC7BO,IAAM,aAAc,uBAAM;AAC/B,MAAI,SAAS;AACb,SAAO,MAAM;AACX,QAAI,WAAW,IAAI;AACjB,aAAO;AAAA,IACT;AACA,UAAM,UAAU,OAAO,OAAO;AAC9B,QAAI,CAAC,SAAS;AACZ,YAAM,IAAI,MAAM,qDAAkD;AAAA,IACpE;AACA,aAAS,QAAQ,SAAS,GAAG,IAAI,QAAQ,MAAM,GAAG,EAAE,IAAI;AACxD,WAAO;AAAA,EACT;AACF,GAAG;AAGH,IAAM,WAAW,CAAC,SAAU,KAAK,WAAW,MAAM,IAAI,OAAO,GAAG,WAAW,CAAC,GAAG,IAAI;AAGnF,IAAM,qBAAqB,MAAM;AAC/B,YAAU,WAAW;AACrB,QAAM,SAAS;AACf,MAAI,OAAO,OAAO,OAAO,QAAQ,QAAQ;AACvC,WAAO,IAAI,SAAS,OAAO;AAAA,EAC7B,OAAO;AACL,WAAO,SAAS,OAAO;AAAA,EACzB;AACF;AAGA,IAAM,eAAe,CAAC,kBAAkB;AAAA,EACtC,gBAAgB;AAAA,EAChB,GAAG;AACL;AAGA,IAAM,eAAe,OAAO,aAAa,SAAS,KAAK,EAAE,MAAM,MAAM,IAAI;AAOlE,IAAM,YAAY,OAAO,MAAM,UAAU,CAAC,MAAM;AACrD,QAAM,EAAE,SAAS,OAAO,MAAM,UAAU,CAAC,GAAG,GAAG,KAAK,IAAI;AACxD,QAAM,kBAAkB,aAAa,OAAO;AAC5C,QAAM,QAAQ,UAAU,SAAS,KAAK,aAAa,QAAQ,KAAK;AAEhE,MAAI,OAAO;AACT,oBAAgB,gBAAgB,UAAU,KAAK;AAAA,EACjD;AAEA,QAAM,WAAW,MAAM,MAAM,SAAS,IAAI,GAAG;AAAA,IAC3C;AAAA,IACA,aAAa;AAAA,IACb,SAAS;AAAA,IACT,MAAM,SAAS,SAAY,SAAY,KAAK,UAAU,IAAI;AAAA,IAC1D,GAAG;AAAA,EACL,CAAC;AAED,QAAM,UAAU,MAAM,aAAa,QAAQ;AAC3C,MAAI,CAAC,SAAS,IAAI;AAChB,QAAI,SAAS,WAAW,KAAK;AAC3B,yBAAmB;AAAA,IACrB;AACA,UAAM,MAAM,SAAS,SAAS;AAAA,MAC5B,MAAM,QAAQ,SAAS,MAAM;AAAA,MAC7B,SAAS,SAAS;AAAA,IACpB;AACA,UAAM,EAAE,QAAQ,SAAS,QAAQ,OAAO,IAAI;AAAA,EAC9C;AAEA,SAAO;AACT;AAGA,IAAM,WAAW,CAAC,WAAW,CAAC,MAAM,SAAS,UAAU,MAAM,EAAE,QAAQ,KAAK,CAAC;AAG7E,IAAM,cAAc,CAAC,WAAW,CAAC,SAAS,UAAU,MAAM,EAAE,OAAO,CAAC;AAG7D,IAAM,WAAW,SAAS,MAAM;AAGhC,IAAM,YAAY,SAAS,OAAO;AAGlC,IAAM,aAAa,YAAY,QAAQ;AAGvC,IAAM,UAAU,YAAY,KAAK;;;AC5FxC,IAAM,eAAe;AAErB,IAAM,SAAS,MAAM;AACnB,QAAM,MAAM,SAAS,eAAe,KAAK;AACzC,MAAI,CAAC;AAAK;AACV,MAAI,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,0GAcwF,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA8BpH,QAAM,OAAO,SAAS,eAAe,eAAe;AACpD,QAAM,eAAe,SAAS,eAAe,eAAe;AAC3D,QAAM,YAAY,SAAS,eAAe,YAAY;AACvD,QAAM,iBAAiB,SAAS,eAAe,kBAAkB;AACjE,QAAM,iBAAiB,UAAU,OAAO,UAAU;AAChD,UAAM,eAAe;AACrB,UAAM,aAAa,SAAS,eAAe,OAAO;AAClD,UAAMA,iBAAgB,SAAS,eAAe,UAAU;AACxD,UAAMC,gBAAe,SAAS,eAAe,kBAAkB;AAC/D,UAAM,QAAQ,YAAY,MAAM,KAAK,KAAK;AAC1C,UAAM,WAAWD,gBAAe,SAAS;AACzC,UAAM,UAAUC,eAAc,SAAS;AACvC,UAAM,eAAe,KAAK,cAAc,uBAAuB;AAC/D,UAAM,cAAc,CAAC,SAAS;AAC5B,UAAI,CAAC;AAAgB;AACrB,UAAI,MAAM;AACR,uBAAe,UAAU,IAAI,QAAQ;AAAA,MACvC,OAAO;AACL,uBAAe,UAAU,OAAO,QAAQ;AAAA,MAC1C;AACA,UAAI,cAAc;AAChB,qBAAa,WAAW;AAAA,MAC1B;AAAA,IACF;AACA,UAAM,kBAAkB,MAAM;AAC5B,UAAI,CAAC;AAAW;AAChB,gBAAU,YAAY;AACtB,UAAIA,eAAc,UAAU,IAAI;AAC9B,kBAAU,cAAc;AACxB;AAAA,MACF;AACA,UAAID,gBAAe,UAAUC,eAAc,OAAO;AAChD,kBAAU,cAAc;AACxB,kBAAU,UAAU,IAAI,SAAS;AAAA,MACnC,OAAO;AACL,kBAAU,cAAc;AACxB,kBAAU,UAAU,IAAI,OAAO;AAAA,MACjC;AAAA,IACF;AACA,oBAAgB;AAChB,QAAI,CAAC,MAAM,MAAM,YAAY,GAAG;AAC9B,mBAAa,cAAc;AAC3B;AAAA,IACF;AACA,QAAI,SAAS,SAAS,GAAG;AACvB,mBAAa,cAAc;AAC3B;AAAA,IACF;AACA,QAAI,aAAa,SAAS;AACxB,mBAAa,cAAc;AAC3B;AAAA,IACF;AACA,QAAI;AACF,mBAAa,cAAc;AAC3B,kBAAY,IAAI;AAChB,YAAM,SAAS,kBAAkB,EAAE,OAAO,SAAS,CAAC;AACpD,aAAO,SAAS,OAAO;AAAA,IACzB,SAAS,KAAK;AACZ,YAAM,UAAU,KAAK,OAAO,WAAW;AACvC,mBAAa,cAAc;AAAA,IAC7B,UAAE;AACA,kBAAY,KAAK;AAAA,IACnB;AAAA,EACF,CAAC;AAED,QAAM,gBAAgB,SAAS,eAAe,UAAU;AACxD,QAAM,eAAe,SAAS,eAAe,kBAAkB;AAC/D,QAAM,iBAAiB,MAAM;AAC3B,QAAI,CAAC;AAAW;AAChB,cAAU,YAAY;AACtB,QAAI,cAAc,UAAU,IAAI;AAC9B,gBAAU,cAAc;AACxB;AAAA,IACF;AACA,QAAI,eAAe,UAAU,cAAc,OAAO;AAChD,gBAAU,cAAc;AACxB,gBAAU,UAAU,IAAI,SAAS;AAAA,IACnC,OAAO;AACL,gBAAU,cAAc;AACxB,gBAAU,UAAU,IAAI,OAAO;AAAA,IACjC;AAAA,EACF;AACA,iBAAe,iBAAiB,SAAS,cAAc;AACvD,gBAAc,iBAAiB,SAAS,cAAc;AAGtD,QAAM,WAAW,CAAC,SAAS,eAAe,OAAO,GAAG,eAAe,cAAc,MAAM,cAAc,uBAAuB,CAAC;AAC7H,QAAM,cAAc,CAAC,WAAW;AAC9B,QAAI,UAAU,OAAO,OAAO,UAAU,YAAY;AAChD,aAAO,MAAM;AAAA,IACf;AAAA,EACF;AACA,cAAY,SAAS,CAAC,CAAC;AAEvB,WAAS,QAAQ,CAAC,IAAI,QAAQ;AAC5B,QAAI,CAAC;AAAI;AACT,OAAG,iBAAiB,WAAW,CAAC,UAAU;AACxC,UAAI,MAAM,QAAQ;AAAO;AACzB,YAAM,eAAe;AACrB,YAAM,OAAO,UAAU,MAAM,KAAK,SAAS,MAAM;AACjD,kBAAY,IAAI;AAAA,IAClB,CAAC;AAAA,EACH,CAAC;AACH;AAEA,SAAS,iBAAiB,oBAAoB,MAAM;",
  "names": ["passwordInput", "confirmInput"]
}
