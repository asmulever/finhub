{
  "version": 3,
  "sources": ["../../Frontend/auth/authStore.js", "../../Frontend/apicliente.js", "../../Frontend/components/passwordToggle.js", "../../Frontend/paginas/login.js"],
  "sourcesContent": ["const TOKEN_KEY = 'finhub_token';\nconst TOKEN_EXP_KEY = 'finhub_token_exp';\nconst PROFILE_KEY = 'finhub_profile';\nconst storage = sessionStorage;\n\nconst nowSeconds = () => Math.floor(Date.now() / 1000);\n\nexport const authStore = {\n  getToken() {\n    const exp = Number(storage.getItem(TOKEN_EXP_KEY) || 0);\n    if (exp && nowSeconds() >= exp) {\n      this.clearToken();\n      return null;\n    }\n    return storage.getItem(TOKEN_KEY);\n  },\n  setToken(token, expiresInSeconds = 3600) {\n    storage.setItem(TOKEN_KEY, token);\n    storage.setItem(TOKEN_EXP_KEY, String(nowSeconds() + expiresInSeconds));\n  },\n  clearToken() {\n    storage.removeItem(TOKEN_KEY);\n    storage.removeItem(TOKEN_EXP_KEY);\n    storage.removeItem(PROFILE_KEY);\n  },\n  setProfile(profile) {\n    storage.setItem(PROFILE_KEY, JSON.stringify(profile));\n  },\n  getProfile() {\n    const value = storage.getItem(PROFILE_KEY);\n    return value ? JSON.parse(value) : null;\n  },\n};\n", "import { authStore } from './auth/authStore.js';\n\n/** Devuelve en tiempo de ejecuci\u00F3n la URL base que indica el entorno sin ning\u00FAn hardcode. */\nexport const getBaseUrl = (() => {\n  let cached = '';\n  return () => {\n    if (cached !== '') {\n      return cached;\n    }\n    const envBase = window.__ENV?.API_BASE_URL;\n    if (!envBase) {\n      throw new Error('API_BASE_URL no est\u00E1 configurada en window.__ENV');\n    }\n    cached = envBase.endsWith('/') ? envBase.slice(0, -1) : envBase;\n    return cached;\n  };\n})();\n\n/** Construye la URL final agregando la base configurada si la ruta es relativa. */\nconst buildUrl = (path) => (path.startsWith('http') ? path : `${getBaseUrl()}${path}`);\n\n/** Borra el token y redirige al login (forzando la ventana top) si el backend responde con 401. */\nconst handleUnauthorized = () => {\n  authStore.clearToken();\n  const target = '/';\n  if (window.top && window.top !== window) {\n    window.top.location.href = target;\n  } else {\n    window.location.href = target;\n  }\n};\n\n/** Fusiona headers adicionales con el header JSON obligatorio. */\nconst buildHeaders = (extraHeaders) => ({\n  'Content-Type': 'application/json',\n  ...extraHeaders,\n});\n\n/** Extrae el payload JSON o devuelve null si no viene contenido v\u00E1lido. */\nconst parsePayload = async (response) => response.json().catch(() => null);\n\n/**\n * Env\u00EDa una petici\u00F3n HTTP contra la API, gestionando tokens, errores y JSON.\n * @param path Ruta relativa o absoluta del recurso.\n * @param options Configuraci\u00F3n adicional de fetch.\n */\nexport const apiClient = async (path, options = {}) => {\n  const { method = 'GET', body, headers = {}, ...rest } = options;\n  const composedHeaders = buildHeaders(headers);\n  const token = authStore.getToken() ?? localStorage.getItem(\"jwt\");\n\n  if (token) {\n    composedHeaders.Authorization = `Bearer ${token}`;\n  }\n  \n  const response = await fetch(buildUrl(path), {\n    method,\n    credentials: 'include',\n    headers: composedHeaders,\n    body: body === undefined ? undefined : JSON.stringify(body),\n    ...rest,\n  });\n\n  const payload = await parsePayload(response);\n  if (!response.ok) {\n    if (response.status === 401) {\n      handleUnauthorized();\n    }\n    const err = payload?.error ?? {\n      code: `http.${response.status}`,\n      message: response.statusText,\n    };\n    throw { status: response.status, error: err };\n  }\n\n  return payload;\n};\n\n/** Genera un helper para m\u00E9todos que env\u00EDan body JSON. */\nconst withBody = (method) => (path, body) => apiClient(path, { method, body });\n\n/** Genera un helper para m\u00E9todos sin body. */\nconst withoutBody = (method) => (path) => apiClient(path, { method });\n\n/** Env\u00EDa un POST con body serializado. */\nexport const postJson = withBody('POST');\n\n/** Env\u00EDa un PATCH con body serializado. */\nexport const patchJson = withBody('PATCH');\n\n/** Ejecuta una petici\u00F3n DELETE sin body. */\nexport const deleteJson = withoutBody('DELETE');\n\n/** Ejecuta una petici\u00F3n GET sin body. */\nexport const getJson = withoutBody('GET');\n", "export const setupPasswordToggle = (input, button) => {\n  const setState = (visible) => {\n    input.type = visible ? 'text' : 'password';\n    button.textContent = visible ? '\uD83D\uDE48' : '\uD83D\uDC41\uFE0F';\n    button.setAttribute('aria-label', visible ? 'Ocultar contrase\u00F1a' : 'Mostrar contrase\u00F1a');\n  };\n  button.addEventListener('click', (event) => {\n    event.preventDefault();\n    setState(input.type !== 'text');\n  });\n  setState(false);\n};\n", "import { getJson, postJson } from '../apicliente.js';\nimport { authStore } from '../auth/authStore.js';\nimport { setupPasswordToggle } from '../components/passwordToggle.js';\n\nconst render = () => {\n  const app = document.getElementById('app');\n  if (!app) return;\n  app.innerHTML = `\n    <div class=\"container\">\n      <div class=\"row g-4 login-row\">\n        <div class=\"col-12 col-lg-6 hero-col\">\n          <div class=\"hero\">\n            <img src=\"/logo/full_logoweb.png\" alt=\"FinHub\" class=\"logo\" />\n            <h1>Impulsa tu portafolio con inteligencia conectada.</h1>\n            <p class=\"tagline\">Conecta tu portafolio con la inteligencia del mercado en tiempo real.</p>\n            <p class=\"description\">FinHub centraliza usuarios, instrumentos y precios hist\u00F3ricos con trazabilidad, alertas y pipelines ETL idempotentes.</p>\n            <ul class=\"feature-list\">\n              <li class=\"feature\">Visibilidad completa de instrumentos en tiempo real.</li>\n              <li class=\"feature\">Alertas inteligentes y trazabilidad transparente.</li>\n              <li class=\"feature\">Pipelines ETL idempotentes con auditor\u00EDa integrada.</li>\n            </ul>\n          </div>\n        </div>\n        <div class=\"col-12 col-lg-6 form-col\">\n          <section class=\"panel login-card\">\n            <div class=\"panel-content\">\n              <div class=\"login-header\">\n                <p class=\"caption\">Inicio seguro</p>\n                <h2>Accede a tu panel FinHub</h2>\n              </div>\n              <p class=\"panel-copy\">Accede a reportes, ABMs y controles de ownership sin dejar de lado el control de acceso y los registros necesarios.</p>\n              <form id=\"login-form\">\n                <div class=\"input-grid\">\n                  <div class=\"form-group\">\n                    <label for=\"email\">Correo</label>\n                    <div class=\"input-field\">\n                      <input id=\"email\" name=\"email\" type=\"email\" required autocomplete=\"username\" />\n                    </div>\n                  </div>\n                  <div class=\"form-group password-group\">\n                    <label for=\"password\">Contrase\u00F1a</label>\n                    <div class=\"password-field\">\n                      <input id=\"password\" name=\"password\" type=\"password\" required autocomplete=\"current-password\" />\n                      <button id=\"toggle-password\" type=\"button\" aria-label=\"Mostrar contrase\u00F1a\" title=\"Mostrar contrase\u00F1a\">\uD83D\uDC41\uFE0F</button>\n                    </div>\n                  </div>\n                </div>\n                <div class=\"form-options\">\n                  <label class=\"checkbox\">\n                    <input id=\"remember-user\" name=\"remember\" type=\"checkbox\" />\n                    <span>Recordar usuario</span>\n                  </label>\n                  <a href=\"/Frontend/register.html\" class=\"register-link\">Registrar nuevo usuario</a>\n                </div>\n                <button type=\"submit\">Ingresar</button>\n                <p id=\"error-message\" class=\"error\" aria-live=\"polite\"></p>\n              </form>\n              <div class=\"login-footer\">\n                <span>\u00BFNecesitas acceso?</span>\n                <strong>Solicita credenciales con tu equipo de operaciones.</strong>\n              </div>\n            </div>\n          </section>\n        </div>\n      </div>\n    </div>\n  `;\n  const passwordInput = document.getElementById('password');\n  const toggleButton = document.getElementById('toggle-password');\n  if (passwordInput && toggleButton) {\n    setupPasswordToggle(passwordInput, toggleButton);\n  }\n  const form = document.getElementById('login-form');\n  const errorMessage = document.getElementById('error-message');\n  form.addEventListener('submit', async (event) => {\n    event.preventDefault();\n    const formData = new FormData(form);\n    const payload = {\n      email: formData.get('email'),\n      password: formData.get('password'),\n    };    \n\n    try {\n      errorMessage.textContent = '';\n      const response = await postJson('/auth/login', payload);\n      authStore.setToken(response.token);\n      authStore.setProfile(response.user);\n      window.location.href = '/Frontend/app.php';\n    } catch (err) {      \n      const message = err?.error?.message ?? 'No se pudo iniciar sesi\u00F3n';\n      errorMessage.textContent = message;\n    }\n  });\n};\n\ndocument.addEventListener('DOMContentLoaded', render);\n\n// Validar sesi\u00F3n al iniciar y redirigir si es v\u00E1lida\ndocument.addEventListener('DOMContentLoaded', async () => {\n  try {\n    if (!authStore.getToken()) return;\n    await getJson('/me');\n      window.location.href = '/Frontend/app.php';\n  } catch {\n    // sesi\u00F3n no v\u00E1lida, continuar en login\n  }\n});\n"],
  "mappings": "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",
  "names": []
}
