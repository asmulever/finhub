<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FinHub | Or√°culo</title>
  <link rel="icon" href="/logo/favicon.png" />
  <script>
    window.__ENV = window.__ENV ?? {};
    window.__ENV.API_BASE_URL = '/api';
  </script>
  <style>
    :root { font-family: 'Inter', system-ui, sans-serif; --bg: #050915; --card: rgba(10, 14, 28, 0.92); --border: rgba(148,163,184,0.25); --text: #e2e8f0; --muted: #94a3b8; --accent: #22d3ee; }
    body { margin: 0; background: radial-gradient(circle at 18% 22%, #0f172a 0%, #050915 52%, #030712 100%); color: var(--text); }
    .content-shell { padding: 18px 18px 26px; }
    main { display: grid; gap: 14px; max-width: 1280px; margin: 0 auto; }
    .card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 16px 18px; box-shadow: 0 15px 40px rgba(0,0,0,0.35); }
    h1, h2, h3, h4 { margin: 0 0 8px 0; }
    .muted { color: var(--muted); font-size: 0.95rem; }
    .hero { display: flex; flex-wrap: wrap; justify-content: space-between; gap: 14px; align-items: center; }
    .hero .meta { display: flex; gap: 8px; align-items: center; flex-wrap: wrap; }
    .pill { display: inline-flex; align-items: center; gap: 6px; border-radius: 999px; padding: 6px 12px; font-size: 0.85rem; border: 1px solid rgba(56, 189, 248, 0.35); background: rgba(14, 165, 233, 0.08); color: #e0f2fe; }
    .pill.warn { border-color: rgba(248, 113, 113, 0.5); background: rgba(248, 113, 113, 0.12); color: #fecaca; }
    .tabs { display: flex; gap: 10px; overflow-x: auto; padding: 6px 0; }
    .tab-btn { background: rgba(15, 23, 42, 0.7); color: var(--text); border: 1px solid var(--border); border-radius: 12px; padding: 10px 14px; font-weight: 700; cursor: pointer; white-space: nowrap; }
    .tab-btn.active { border-color: rgba(56,189,248,0.65); background: rgba(14,165,233,0.12); color: #e0f2fe; }
    .tab-panel { display: none; }
    .tab-panel.active { display: block; }
    .table-wrapper { width: 100%; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; color: var(--text); font-size: 0.92rem; }
    th, td { padding: 9px 8px; border-bottom: 1px solid rgba(148,163,184,0.2); text-align: left; }
    th { color: var(--muted); font-weight: 700; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 10px; }
    .stat { background: rgba(15, 23, 42, 0.7); border: 1px solid var(--border); border-radius: 12px; padding: 10px; }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    input, select { background: #0f172a; color: var(--text); border: 1px solid rgba(148,163,184,0.4); border-radius: 10px; padding: 10px 12px; min-width: 140px; }
    button.action { background: linear-gradient(120deg, #22d3ee, #0ea5e9); border: none; color: #0b1021; padding: 10px 14px; border-radius: 10px; font-weight: 700; cursor: pointer; }
    button.secondary { background: rgba(56, 189, 248, 0.12); color: #e0f2fe; border: 1px solid rgba(56, 189, 248, 0.35); padding: 9px 12px; border-radius: 10px; font-weight: 700; cursor: pointer; }
    .status { font-weight: 700; }
    .hint { color: #38bdf8; font-weight: 600; cursor: help; }
    .badge { display: inline-flex; align-items: center; gap: 6px; border-radius: 999px; padding: 4px 10px; font-size: 0.82rem; border: 1px solid rgba(148, 163, 184, 0.35); background: rgba(148, 163, 184, 0.12); color: #e2e8f0; }
    .soft { color: #cbd5f5; }
    .error { color: #f87171; font-weight: 700; min-height: 20px; }
    .tooltip { border-bottom: 1px dashed rgba(148,163,184,0.8); cursor: help; }
    .cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 10px; }
    .card-item { background: rgba(15, 23, 42, 0.72); border: 1px solid var(--border); border-radius: 12px; padding: 10px 12px; display: grid; gap: 6px; }
    .tag { display: inline-flex; align-items: center; gap: 4px; padding: 4px 8px; border-radius: 999px; border: 1px solid rgba(148, 163, 184, 0.35); background: rgba(148, 163, 184, 0.15); font-size: 0.82rem; }
    @media (max-width: 768px) {
      .content-shell { padding: 14px 12px 20px; }
      .tabs { position: sticky; top: 0; background: linear-gradient(90deg, rgba(5,9,21,0.94), rgba(5,9,21,0.86)); padding: 8px 2px; z-index: 5; }
      .hero { align-items: flex-start; }
      table { font-size: 0.88rem; }
      th, td { padding: 8px 6px; }
    }
  </style>
</head>
<body>
  <div class="content-shell">
    <main>
      <section class="card hero">
        <div>
          <p class="muted" style="margin:0 0 6px 0;">Orquestador ¬∑ Se√±ales, Riesgo, Proyecciones</p>
          <h1>Or√°culo</h1>
          <p class="muted">BUY/SELL/HOLD con racional, r√©gimen, estrategia y sizing. Integra se√±ales, rango esperado, stops y escenarios Monte Carlo b√°sicos.</p>
        </div>
        <div class="meta">
          <span class="pill" id="badge-signals">-- se√±ales</span>
          <span class="pill" id="badge-updated">Actualizado: --</span>
        </div>
      </section>

      <section class="card">
        <div class="tabs" role="tablist" aria-label="Navegaci√≥n Or√°culo">
          <button class="tab-btn active" data-tab="senales" role="tab" aria-selected="true">Se√±ales</button>
          <button class="tab-btn" data-tab="riesgo" role="tab" aria-selected="false">Riesgo ¬∑ Sizing</button>
          <button class="tab-btn" data-tab="proyecciones" role="tab" aria-selected="false">Proyecciones</button>
          <button class="tab-btn" data-tab="backtest" role="tab" aria-selected="false">Backtest ¬∑ Validaci√≥n</button>
        </div>
      </section>

      <section class="card tab-panel active" data-tab-panel="senales">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap;">
          <div>
            <h3>Se√±ales y contexto</h3>
            <p class="muted">Ticker, acci√≥n, confianza, horizonte, r√©gimen, estrategia, entrada, stop/take, expected R y drawdown esperado. Tooltip con ‚Äúpor qu√©‚Äù de la se√±al.</p>
          </div>
          <div class="controls">
            <button id="btn-refresh" class="action" type="button">üîÅ Recalcular</button>
            <div class="status" id="signals-status"></div>
          </div>
        </div>
        <div class="error" id="signals-error"></div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Ticker</th>
                <th>Acci√≥n</th>
                <th>Conf.</th>
                <th>Horizonte</th>
                <th>R√©gimen</th>
                <th>Estrategia</th>
                <th>Entrada</th>
                <th>Stop / Take</th>
                <th>Expected R</th>
                <th>DD esp. P90</th>
                <th>Detalle</th>
              </tr>
            </thead>
            <tbody id="signals-body">
              <tr><td colspan="11" class="muted">Cargando...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="card tab-panel" data-tab-panel="riesgo">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap;">
          <div>
            <h3>Riesgo y sizing</h3>
            <p class="muted">Asigna tama√±o en base a capital y riesgo por operaci√≥n. Usa stop/entrada de la se√±al; calcula capital sugerido y drawdown estimado.</p>
          </div>
          <div class="controls">
            <input id="capital-input" type="number" min="0" step="1000" placeholder="Capital base" value="100000" />
            <input id="risk-input" type="number" min="0.1" max="5" step="0.1" placeholder="Riesgo % op" value="1" />
            <input id="dd-input" type="number" min="1" max="80" step="1" placeholder="DD m√°x %" value="20" />
            <button id="btn-recalc-risk" class="secondary" type="button">Recalcular</button>
          </div>
        </div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Ticker</th>
                <th>Acci√≥n</th>
                <th>Stop dist.</th>
                <th>Tama√±o sugerido</th>
                <th>Capital usado</th>
                <th>Riesgo $</th>
                <th>Expected R</th>
                <th>DD esp. P90</th>
              </tr>
            </thead>
            <tbody id="risk-body">
              <tr><td colspan="8" class="muted">Sin datos.</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="card tab-panel" data-tab-panel="proyecciones">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap;">
          <div>
            <h3>Proyecciones (Monte Carlo b√°sico)</h3>
            <p class="muted">Escenarios P50/P90 derivados de las se√±ales y rangos esperados. Cuando se provean resultados de Monte Carlo, se mostrar√° la probabilidad de drawdown y capital m√≠nimo.</p>
          </div>
          <div class="controls">
            <span class="badge">Basado en se√±ales vivas</span>
          </div>
        </div>
        <div class="cards" id="projections-cards"></div>
      </section>

      <section class="card tab-panel" data-tab-panel="backtest">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap;">
          <div>
            <h3>Backtest y validaci√≥n</h3>
            <p class="muted">Ejecuta trend_breakout con el universo actual. Valida CAGR, DD, Sharpe y trades. Los backtests exitosos se adjuntan como referencia a las se√±ales.</p>
          </div>
          <div class="controls">
            <button class="action" type="button" id="btn-run-backtest">‚ñ∂ Ejecutar</button>
            <span class="badge" id="backtest-badge">Listo</span>
          </div>
        </div>
        <div class="grid" style="margin-bottom:10px;">
          <div class="stat">
            <strong>Par√°metros</strong>
            <div class="controls" style="margin-top:8px;">
              <label class="muted" style="display:block;">Ventana</label>
              <select id="bt-window">
                <option value="6m">√öltimos 6 meses</option>
                <option value="1y" selected>√öltimo a√±o</option>
                <option value="2y">√öltimos 2 a√±os</option>
              </select>
              <label class="muted" style="display:block;margin-top:6px;">Perfil</label>
              <select id="bt-profile">
                <option value="conservador">Conservador</option>
                <option value="base" selected>Base</option>
                <option value="agresivo">Agresivo</option>
              </select>
              <label class="muted" style="display:block;margin-top:6px;">Universo (auto)</label>
              <input id="bt-universe" placeholder="Universo detectado" readonly />
              <p class="muted" style="margin-top:6px;font-size:0.9rem;">Los par√°metros de riesgo/costos se toman del perfil seleccionado.</p>
            </div>
            <div class="status" id="backtest-status"></div>
            <div class="error" id="backtest-error"></div>
          </div>
          <div class="stat" id="backtest-metrics">
            <strong>M√©tricas</strong>
            <p class="muted">Ejecuta un backtest para ver CAGR, MaxDD, Sharpe, Sortino, WinRate, ProfitFactor, Expectancy, Exposure.</p>
          </div>
        </div>
        <div class="cards" id="backtest-cards"></div>
        <div class="table-wrapper" style="margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Equity</th>
                <th>Drawdown</th>
              </tr>
            </thead>
            <tbody id="backtest-equity-body">
              <tr><td colspan="3" class="muted">Sin equity.</td></tr>
            </tbody>
          </table>
        </div>
        <div class="table-wrapper" style="margin-top:10px;">
          <table>
            <thead>
              <tr>
                <th>Symbol</th>
                <th>Entrada</th>
                <th>Salida</th>
                <th>Qty</th>
                <th>PNL neto</th>
                <th>Raz√≥n</th>
              </tr>
            </thead>
            <tbody id="backtest-trades-body">
              <tr><td colspan="6" class="muted">Sin trades.</td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>
  <script type="module" src="/Frontend/paginas/oraculo.js"></script>
</body>
</html>
