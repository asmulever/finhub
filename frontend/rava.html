<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FinHub | RAVA CEDEARs</title>
  <link rel="icon" href="/logo/favicon.png" />
  <script>
    window.__ENV = window.__ENV ?? {};
    window.__ENV.API_BASE_URL = '/api';
  </script>
  <link rel="preload" href="/logo/full_logoweb.png" as="image" />
  <style>
    :root { font-family: 'Inter', system-ui, sans-serif; }
    body { margin: 0; background: #0b1021; color: #e2e8f0; }
    .content-shell { padding: 24px 32px; }
    main { display: grid; gap: 18px; max-width: 1400px; margin: 0 auto; }
    .card { background: rgba(13, 18, 35, 0.9); border: 1px solid rgba(148, 163, 184, 0.25); border-radius: 14px; padding: 18px 20px; box-shadow: 0 15px 40px rgba(0,0,0,0.35); }
    h2, h3 { margin: 0 0 8px 0; }
    .muted { color: #94a3b8; font-size: 0.95rem; }
    .eyebrow { text-transform: uppercase; letter-spacing: 0.08em; font-weight: 700; color: #38bdf8; font-size: 0.78rem; margin: 0 0 6px 0; }
    .hero { display: flex; justify-content: space-between; gap: 14px; flex-wrap: wrap; }
    .hero .meta { display: flex; gap: 10px; align-items: center; }
    .badge { display: inline-flex; align-items: center; gap: 6px; border-radius: 999px; padding: 6px 12px; font-size: 0.85rem; border: 1px solid rgba(56, 189, 248, 0.35); background: rgba(14, 165, 233, 0.08); color: #e0f2fe; }
    .badge.warn { border-color: rgba(248, 113, 113, 0.5); background: rgba(248, 113, 113, 0.1); color: #fecaca; }
    .badge.neutral { border-color: rgba(148, 163, 184, 0.4); background: rgba(148, 163, 184, 0.15); color: #e2e8f0; }
    .submenu { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 12px; }
    .submenu .subitem { background: transparent; border: 1px solid rgba(148, 163, 184, 0.35); color: inherit; border-radius: 10px; padding: 9px 14px; cursor: pointer; }
    .submenu .subitem.active { border-color: rgba(56, 189, 248, 0.7); background: rgba(14, 165, 233, 0.12); }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: space-between; }
    .controls-left { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; }
    .controls-right { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    input { background: #0f172a; color: #e2e8f0; border: 1px solid rgba(148,163,184,0.4); border-radius: 10px; padding: 10px 12px; min-width: 200px; }
    button.action { background: linear-gradient(120deg, #22d3ee, #0ea5e9); border: none; color: #0b1021; padding: 10px 14px; border-radius: 10px; font-weight: 600; cursor: pointer; }
    button.secondary { background: rgba(15, 23, 42, 0.8); border: 1px solid rgba(148, 163, 184, 0.4); color: #e2e8f0; padding: 9px 14px; border-radius: 10px; font-weight: 600; cursor: pointer; }
    .status-row { display: flex; gap: 14px; flex-wrap: wrap; margin: 12px 0 6px 0; color: #cbd5f5; font-size: 0.92rem; }
    .error { color: #f87171; font-weight: 600; min-height: 20px; }
    .table-wrapper { overflow-x: auto; border-radius: 12px; border: 1px solid rgba(148, 163, 184, 0.2); }
    .small { font-size: 0.82rem; color: #94a3b8; }
    .pos { color: #4ade80; font-weight: 700; }
    .neg { color: #f87171; font-weight: 700; }
    .hidden { display: none; }
    table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
    thead { background: rgba(15, 23, 42, 0.8); }
    th, td { padding: 10px 8px; text-align: left; }
    th { font-weight: 700; color: #cbd5f5; border-bottom: 1px solid rgba(148, 163, 184, 0.25); }
    tr:nth-child(even) td { background: rgba(15, 23, 42, 0.4); }
    tr:hover td { background: rgba(14, 165, 233, 0.06); }
    .pill { display: inline-flex; padding: 4px 8px; border-radius: 999px; background: rgba(56, 189, 248, 0.12); border: 1px solid rgba(56, 189, 248, 0.4); color: #e0f2fe; font-size: 0.82rem; }
    pre { background: #0f172a; color: #e2e8f0; border-radius: 10px; padding: 12px; overflow: auto; font-size: 0.9rem; max-height: 260px; }
    .clickable-row { cursor: pointer; }
    .history-hint { color: #cbd5f5; font-size: 0.9rem; }
    @media (max-width: 768px) {
      .content-shell { padding: 16px; }
      input { min-width: 160px; }
      th, td { padding: 8px 6px; }
    }
  </style>
</head>
<body>
  <div class="content-shell">
    <main>
      <section class="card hero">
        <div>
          <p class="eyebrow">Market Data · RAVA</p>
          <h2>CEDEARs en vivo desde RAVA</h2>
          <p class="muted">Se extrae el payload embebido en el HTML (<code>&lt;cedears-p :datos="..."&gt;</code>), sin XHR adicional. Cache corto en mercado, largo fuera, con fallback stale.</p>
        </div>
        <div class="meta">
          <span class="badge" id="badge-cache">live</span>
          <span class="badge neutral" id="badge-stale">ok</span>
        </div>
      </section>

      <section class="card">
        <div class="submenu">
          <button class="subitem active" type="button" data-view="cedears">RAVA · CEDEARs</button>
          <button class="subitem" type="button" data-view="acciones">Acciones Argentinas</button>
          <button class="subitem" type="button" data-view="bonos">Bonos</button>
        </div>
      </section>

      <section class="card" id="view-cedears">
        <div class="controls">
          <div class="controls-left">
            <input id="filter-input" placeholder="Filtrar símbolo, especie o panel" />
          </div>
          <div class="controls-right">
            <button id="reload-btn" class="action" type="button">Recargar</button>
          </div>
        </div>
        <div class="status-row">
          <span id="status-updated">Actualizado: --</span>
          <span id="status-count">CEDEARs: --</span>
          <span id="status-meta"></span>
        </div>
        <div id="rava-error" class="error"></div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Símbolo</th>
                <th>Último</th>
                <th>Var %</th>
                <th>Var MTD/YTD</th>
                <th>Apertura</th>
                <th>Mín / Máx</th>
                <th>CCL</th>
                <th>Vol nominal</th>
                <th>Vol efectivo</th>
                <th>Hora</th>
                <th>Ratio</th>
              </tr>
            </thead>
            <tbody id="cedears-body"></tbody>
          </table>
        </div>
      </section>

      <section class="card hidden" id="view-acciones">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
          <div>
            <h3>Acciones Argentinas (RAVA)</h3>
            <p class="muted">Payload embebido en <code>&lt;acciones-argentinas :datos="..."&gt;</code>. Segmentado por panel (GEN, LID, etc.).</p>
          </div>
          <div class="meta">
            <span class="badge" id="badge-acc-cache">live</span>
            <span class="badge neutral" id="badge-acc-stale">ok</span>
          </div>
        </div>
        <div class="controls">
          <div class="controls-left">
            <input id="acciones-filter-input" placeholder="Filtrar símbolo, especie o panel" />
          </div>
          <div class="controls-right">
            <button id="acciones-reload-btn" class="action" type="button">Recargar</button>
          </div>
        </div>
        <div class="status-row">
          <span id="status-acc-updated">Actualizado: --</span>
          <span id="status-acc-count">Acciones: --</span>
          <span id="status-acc-meta"></span>
        </div>
        <div id="acciones-error" class="error"></div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Símbolo</th>
                <th>Último</th>
                <th>Var %</th>
                <th>Var MTD/YTD</th>
                <th>Apertura</th>
                <th>Mín / Máx</th>
                <th>Bid x Size</th>
                <th>Ask x Size</th>
                <th>Vol nominal</th>
                <th>Vol efectivo</th>
                <th>Hora</th>
                <th>Panel</th>
              </tr>
            </thead>
            <tbody id="acciones-body"></tbody>
          </table>
        </div>
      </section>

      <section class="card hidden" id="view-bonos">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
          <div>
            <h3>Bonos (RAVA)</h3>
            <p class="muted">Extraído de <code>&lt;bonos-p :datos="..."&gt;</code>. Incluye ARS y USD.</p>
          </div>
          <div class="meta">
            <span class="badge" id="badge-bonos-cache">live</span>
            <span class="badge neutral" id="badge-bonos-stale">ok</span>
          </div>
        </div>
        <div class="controls">
          <div class="controls-left">
            <input id="bonos-filter-input" placeholder="Filtrar símbolo, especie o panel" />
          </div>
          <div class="controls-right">
            <button id="bonos-reload-btn" class="action" type="button">Recargar</button>
          </div>
        </div>
        <div class="status-row">
          <span id="status-bonos-updated">Actualizado: --</span>
          <span id="status-bonos-count">Bonos: --</span>
          <span id="status-bonos-meta"></span>
        </div>
        <div id="bonos-error" class="error"></div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Símbolo</th>
                <th>Último</th>
                <th>Var %</th>
                <th>Var MTD/YTD</th>
                <th>Apertura</th>
                <th>Mín / Máx</th>
                <th>Bid x Size</th>
                <th>Ask x Size</th>
                <th>Vol nominal</th>
                <th>Vol efectivo</th>
                <th>Hora</th>
                <th>Panel</th>
              </tr>
            </thead>
            <tbody id="bonos-body"></tbody>
          </table>
        </div>
      </section>

      <section class="card" id="view-historicos">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
          <div>
            <h3>Histórico diario (RAVA)</h3>
            <p class="muted">Haz click en cualquier símbolo para consultar el histórico vía REST (<code>/lib/restapi/v3/publico/cotizaciones/historicos</code> con <code>access_token</code> tomado del perfil).</p>
          </div>
          <div class="meta">
            <span class="badge neutral" id="history-symbol">Símbolo: --</span>
            <span class="badge neutral" id="history-count">Registros: --</span>
          </div>
        </div>
        <div class="status-row">
          <span id="history-status" class="history-hint">Selecciona un símbolo para ver su histórico.</span>
          <span id="history-meta"></span>
        </div>
        <div id="history-error" class="error"></div>
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Fecha</th>
                <th>Apertura</th>
                <th>Máximo</th>
                <th>Mínimo</th>
                <th>Cierre</th>
                <th>Var %</th>
                <th>Volumen</th>
                <th>Ajuste</th>
              </tr>
            </thead>
            <tbody id="historicos-body">
              <tr><td colspan="8" class="muted">Sin selección</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <section class="card">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
          <h3>Payload crudo</h3>
          <button id="btn-copy-raw" class="secondary" type="button">Copiar JSON</button>
        </div>
        <pre id="debug-output">{}</pre>
      </section>
    </main>
  </div>
  <script type="module" src="/Frontend/paginas/rava.js"></script>
</body>
</html>
